version: '3'

services:
    web:
        build:
            context: ./
            dockerfile: ./docker/nginx/Dockerfile
        ports:
            - 9090:80
        volumes:
            - ./web:/sharetoall/web
        depends_on:
            - php
        environment:
            - VIRTUAL_HOST=sharetoall.com www.sharetoall.com
            - VIRTUAL_PORT=80

    php:
        build:
            context: ./
            dockerfile: ./docker/php/Dockerfile-prod
        volumes:
            - /var/run/mysqld/mysqld.sock:/var/run/mysqld/mysqld.sock
            - ./web:/sharetoall/web
            - ./storage:/sharetoall/storage
        depends_on:
            - redis

    redis:
        image: redis:3-alpine
