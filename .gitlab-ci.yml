image: php:7.2

services:
- name: mariadb:latest
  alias: db

variables:
  MYSQL_DATABASE: sharetoall
  MYSQL_USER: sharetoall
  MYSQL_PASSWORD: sharetoall
  MYSQL_ROOT_PASSWORD: sharetoall
  MYSQL_HOST: db

before_script:
# Install dependencies
- bash ci/docker_install.sh > /dev/null

test:sharetoall:
  script:
  - echo "SELECT 'OK';" | mysql --user="${MYSQL_USER}" --password="${MYSQL_PASSWORD}" --host=db "${MYSQL_DATABASE}"
  - bin/phing dev
  - phpunit --configuration phpunit.xml
