version: '2'

services:
    web:
        build:
            context: ./
            dockerfile: ./docker/nginx/Dockerfile
        image: ${CI_REGISTRY}/${CI_PROJECT_PATH}:web-latest
        ports:
            - 9090:80
        volumes:
            - ./web:/sharetoall/web
        depends_on:
            - php
        environment:
            - VIRTUAL_HOST=sharetoall.com www.sharetoall.com
            - VIRTUAL_PORT=80
            - HTTP_AUTH_LOGIN=${HTTP_AUTH_LOGIN}
            - HTTP_AUTH_PASSWORD=${HTTP_AUTH_PASSWORD}

    php:
        build:
            context: ./
            dockerfile: ./docker/php/Dockerfile-prod
        image: ${CI_REGISTRY}/${CI_PROJECT_PATH}:php-latest
        volumes:
            # - /var/run/mysqld/mysqld.sock:/var/run/mysqld/mysqld.sock
            # - ./web:/sharetoall/web
            # - ./storage:/sharetoall/storage
        depends_on:
            - redis
        env_file:
            - config.env

    redis:
        build:
            context: ./
            dockerfile: ./docker/redis/Dockerfile
        image: ${CI_REGISTRY}/${CI_PROJECT_PATH}:redis-latest
